!function(a){function d(b,c,d){var e,f;a("#msg").length<=0&&a("body").append('<div id="msg"><div class="msgbox"></div></div>'),e=a("#msg"),f=e.find(".msgbox"),e.show().css({marginTop:"-"+(f.height()+20)/2+"px"}),f.html(b),window.setTimeout(function(){e.fadeOut(),void 0!=d&&null!=d&&d()},c)}function e(){return a("#wp-content-wrap").hasClass("tmce-active")?tinyMCE.activeEditor.getContent():a("#content").val()}function f(b){return void 0==a(b).data("max-checked")?!0:(maxCheck=parseInt(a(b).data("max-checked"),10),a(b).find(":checked").length>=maxCheck?a(b).find("input[type=checkbox]:not(:checked)").attr("disabled",!0):a(b).find("input[type=checkbox]").removeAttr("disabled"),void 0)}function g(a,b,c,d,e){var h,i,f=a.val(),g=b.val();if(d.attr("disabled","disabled").addClass("disabled"),c.removeClass("short bad good strong"),e=e.concat(wp.passwordStrength.userInputBlacklist()),h=wp.passwordStrength.meter(f,e,g),i={empty:"强度评估","short":"非常弱",bad:"比较弱",good:"中等",strong:"强悍",mismatch:"密码不一致"},!f)return c.addClass("short").html(i.empty),void 0;switch(h){case 2:c.addClass("bad").html(i.bad);break;case 3:c.addClass("good").html(i.good);break;case 4:c.addClass("strong").html(i.strong);break;case 5:c.addClass("short").html(i.mismatch);break;default:c.addClass("short").html(i.short)}return 3!==h&&4!==h||""===g.trim()||d.removeAttr("disabled").removeClass("disabled"),h}var b=ajax_dashboard_object.ajaxurl,c=ajax_dashboard_object.redirecturl;a.ajaxaction=function(b,c,d,e){a.ajax({type:"POST",dataType:"json",url:b,data:c,success:function(a){d(a)},complete:function(a,b){e(a,b)}})},a(function(){var h,i,j;a("input.post-submit").on("click",function(f){function j(b){var c=b.message;1==b.updated?document.location.href=b.redirecturl:(a(".message").length>0&&a(".message").remove(),c||(c="<p>非正常提交，请刷新页面后再操作！</p>"),d(c,3e3))}function k(){a("input.post-submit").removeAttr("disabled").removeClass("disabled")}var g,i;if(f.preventDefault(),a(this).attr("disabled",!0).addClass("disabled"),g=a(this).attr("id"),"post-update"==g)h=a("#edit-post"),action="updatepost";else if("post-draft"==g)h=a("#add-post"),action="draftpost";else if("post-pending"==g)h=a(".post-form"),action="pendingpost";else if("photo-update"==g)h=a("#photo-post"),action="updatephoto";else if("photo-draft"==g)h=a("#add-weiran"),action="draftphoto";else{if("photo-pending"!=g)return!1;h=a(".post-form"),action="pendingphoto"}post_id=h.find("#post-id").val(),post_title=h.find("#post-title").val(),post_content=e(),post_category=h.find("#post-cat option:selected").val(),post_tags=h.find("#post-tags").val(),post_author=h.find("#post-author").val(),security=h.find("#security").val(),i=[],"photo-update"==g||"photo-draft"==g||"photo-pending"==g?(post_category=[],post_category=h.find("#category_checklist input:checkbox:checked").map(function(){return a(this).val()}).get(),i=h.find("input.attachment-id").map(function(){return a(this).val()}).get()):a("input.attachment").length>0&&(i=h.find("input.attachment").map(function(){return a(this).val()}).get()),post_param={action:action,post_id:post_id,post_title:post_title,post_content:post_content,"post_category[]":post_category,"post_attachment[]":i,post_tags:post_tags,security:security,referer:c},a.ajaxaction(b,post_param,j,k)}),a("input#update-profile").on("click",function(e){function f(b){var c=b.message;1==b.updated?document.location.href=b.redirecturl:(a(".message").length>0&&a(".message").remove(),c||(c="<p>非正常提交，请刷新页面后再操作！</p>"),d(c,3e3))}function g(){a("input#update-profile").removeAttr("disabled").removeClass("disabled")}e.preventDefault(),a(this).attr("disabled",!0).addClass("disabled"),h=a("#user-edit"),profile_param={action:"update_profile",user_id:h.find("#user_id").val(),user_nicename:h.find("#user_nicename").val(),user_email:h.find("#user_email").val(),user_url:h.find("#user_url").val(),user_sina:h.find("#user_sina").val(),user_tencentwb:h.find("#user_tencentwb").val(),user_qq:h.find("#user_qq").val(),description:h.find("#description").val(),security:h.find("#security").val(),referer:c},a.ajaxaction(b,profile_param,f,g)}),a("input#update-security").on("click",function(e){function f(b){var c=b.message;1==b.updated?document.location.href=b.redirecturl:(a(".message").length>0&&a(".message").remove(),c||(c="<p>非正常提交，请刷新页面后再操作！</p>"),d(c,3e3))}function g(){a("input#update-security").removeAttr("disabled").removeClass("disabled")}e.preventDefault(),a(this).attr("disabled",!0).addClass("disabled"),h=a("#user-security"),security_param={action:"update_security",user_id:h.find("#user_id").val(),pass:h.find("#pass").val(),pass1:h.find("#pass1").val(),pass2:h.find("#pass2").val(),security:h.find("#security").val(),referer:c},a.ajaxaction(b,security_param,f,g)}),a("#avatar-list a").on("click",function(c){function e(b){var c=b.message;1==b.updated?(a(".message.failure").remove(),h.find(".avatar").removeClass("active"),a("#"+$stylePid).parent("div").addClass("active"),a("#user-avatar .format").find("img").attr({src:$chooseurl}),a(".avatar-preview").removeClass("update")):(a(".message").length>0&&a(".message").remove(),c||(c="<p>非正常提交，请刷新页面后再操作！</p>"),d(c,3e3))}function f(){$avatarbox.attr("data-updating","0")}return c.preventDefault(),$avatarbox=a("#avatar-list"),a(this).parent("div").hasClass("active")||"1"==$avatarbox.attr("data-updating")?!1:($avatarbox.attr("data-updating","1"),a(".avatar-preview").addClass("update"),h=a("#user-avatar"),$stylePid=a(this).attr("id"),$chooseurl=a(this).find("img").attr("src"),avatar_param={action:"update_avatar",user_id:h.find("#user_id").val(),style:$stylePid,security:h.find("#security").val()},a.ajaxaction(b,avatar_param,e,f),void 0)}),a("#sns-area .actions a").on("click",function(c){function f(b){var c=b.message;1==b.updated?(h.removeClass("binded"),h.find(".info").html("未绑定"),h.find(".actions").html('<li class="go-bind"><a href="http://www.jiawin.com/oauth/qq">立即绑定</a></li>')):(h.find(".actions a").text("取消绑定"),a(".message").length>0&&a(".message").remove(),c||(c="<p>非正常提交，请刷新页面后再操作！</p>"),d(c,3e3))}function g(){h.find(".actions a").attr("data-updating","0")}var e;return e=confirm("您确定要解除该账号的绑定吗？")?!0:!1,c.preventDefault(),$SNSstyle=a(this).parents(".list").attr("id"),h=a("#"+$SNSstyle),e&&h.hasClass("binded")&&"1"!=a(this).attr("data-updating")?(a(this).attr("data-updating","1").text("解除中..."),sns_param={action:"sns_"+$SNSstyle,user_id:a("#user_id").val(),security:a("#security").val()},a.ajaxaction(b,sns_param,f,g),void 0):!1}),a("input#email-verify").on("click",function(c){function e(b){var c=b.message;1==b.apply?(a(".status-tip").remove(),a("#user-form").after('<div class="status-tip">'+b.message+'<p>如果您已经验证成功，请点击<a href="javascript:location.reload()">刷新</a>本页面。</p></div>')):(a(".message").length>0&&a(".message").remove(),c||(c="<p>非正常提交，请刷新页面后再操作！</p>"),d(c,3e3))}function f(){h.find("input#email-verify").val("获取验证邮件").attr("data-apply","0")}return c.preventDefault(),h=a("#email-form"),"1"==a(this).attr("data-apply")?!1:(a(this).attr("data-apply","1").val("请求验证中..."),email_param={action:"email_verify",email:a("#user_email").val(),security:a("#security").val()},a.ajaxaction(b,email_param,e,f),void 0)}),a("#favorites").on("click",".actions a",function(c){function i(b){var c=b.message;1==b.updated?"heartbeat"==g?f.find(".actions").append(h):"heartlove"==g&&f.removeClass("unlove").find(".heartbeat").show():(a(".message").length>0&&a(".message").remove(),c||(c="<p>非正常提交，请刷新页面后再操作！</p>"),d(c,3e3),"heartbeat"==g?f.removeClass("unlove").find(".heartbeat").show():"heartlove"==g&&f.addClass("unlove").find(".actions").append(h))}function j(){f.attr("data-heart","0"),f.find(".loading").hide()}var e,f,g,h;return c.preventDefault(),e=a(this).data("post-id"),f=a(this).parents("li"),g=a(this).attr("id"),h='<a id="heartlove" data-post-id="'+e+'" class="heartlove" href=""><span class="relove"><i class="fa fa-undo"></i>再次喜欢</a></span></a>',"1"==f.attr("data-heart")?!1:(f.attr("data-heart","1"),"heartbeat"==g?($action="unlove",$security=heartbeat_object.nonce):"heartlove"==g&&($action="relove",$security=relove_object.nonce),f.find(".loading").show(),f.addClass("unlove"),f.find(".heartbeat").hide(),f.find(".heartlove").remove(),love_param={action:$action,post_id:e,security:$security},a.ajaxaction(b,love_param,i,j),void 0)}),a("#upload-container").length>0&&(i=a("#upload-file-list"),j=new plupload.Uploader(javin_dashboard_upload.plupload),a(javin_dashboard_upload.browse_button).click(function(a){j.start(),a.preventDefault()}),j.init(),j.bind("FilesAdded",function(b,c){a("#user-avatar").length>0?a(".avatar-preview").addClass("update"):a("#upload-attachment").length>0?a.each(c,function(a,b){i.append('<div class="file-list" id="'+b.id+'"><div class="progress"><div class="percent"></div><div class="bar"></div>'+"</div></div>")}):a("#upload-personal-bg").length>0?(i.show(),a.each(c,function(a,b){i.append('<div class="file-list" id="'+b.id+'"><div class="progress"><div class="percent"></div><div class="bar"></div>'+"</div></div>")})):a.each(c,function(a,b){i.append('<div class="file-list" id="'+b.id+'"><div class="progress"><div class="percent"></div><div class="bar"></div>'+'</div><div class="filename original">'+b.name+" ("+plupload.formatSize(b.size)+")</div></div>")}),b.refresh(),j.start()}),j.bind("UploadProgress",function(b,c){a("#"+c.id+" .bar").css("width",c.percent+"%"),a("#upload-attachment").length>0||a("#upload-personal-bg").length>0||(a("#"+c.id+" .percent").html(c.percent+"%"),c.percent>=100&&a("#"+c.id+" .percent").html("处理中…"))}),j.bind("Error",function(a,b){alert("错误提示: "+b.message+" 文件: "+b.file.name+" 不允许上传！"),a.refresh()}),j.bind("FileUploaded",function(b,c,d){var f,g,h,j,e=a.parseJSON(d.response);if(e.success)if(a("#user-avatar").length>0)a("#user-avatar .format, .avatar-list .custom").find("img").attr({src:e.src}),!a(".avatar-list .custom").length>0&&a("#avatar-list").append('<li><div class="avatar custom active"><a id="custom" href="javascript:;"><img src="'+e.src+'" class="avatar" width="100" height="100"></a></div><span>自定义头像</span></li>'),a("#user-avatar").find(".avatar").removeClass("active"),a(".avatar-list .custom").addClass("active"),a(".avatar-preview").removeClass("update");else if(a("#upload-attachment").length>0){if(a("#"+c.id).fadeOut(),!a("#post-id").length>0&&a("#security").after('<input class="attachment" type="hidden" name="post-attachment[]" value="'+e.attachment+'" />'),h="undefined"!=typeof tinymce,j="undefined"!=typeof QTags,f)h&&(g=tinymce.get(f));else if(h&&tinymce.activeEditor)g=tinymce.activeEditor,f=g.id;else if(!j)return!1;g&&!g.isHidden()?g.execCommand("mceInsertContent",!1,e.data):j?QTags.insertContent(e.data):document.getElementById(f).value+=e.data}else a("#upload-personal-bg").length>0?(i.hide(),a(".personal-bg-preview").html(e.data)):(a("#"+c.id+" .progress").remove(),a("#"+c.id+" .original").remove(),a("#"+c.id).append(e.html),a(javin_dashboard_upload.browse_button).hide(),a("#post-title").val()||a("#post-title").val(e.title))}),a("#upload-file-list").on("click","#remove-attachment",function(c){if(c.preventDefault(),confirm(javin_dashboard_upload.confirmMsg)){var d=a(this),e={action:"del_upload_photo",attach_id:d.data("id"),nonce:javin_dashboard_upload.nonce};d.text("删除中…"),a.post(b,e,function(a){"success"==a?(d.parent().parent().fadeOut(),window.setTimeout(function(){d.parent().parent().remove()},1500)):(d.text("删除图片"),alert("删除失败，请重新操作！"))})}})),a("#category_checklist").length>0&&f(a("#category_checklist")),a("input[type=checkbox]").click(function(b){a(b.currentTarget).closest("div.checklist").length>0&&f(a(b.currentTarget).closest("div.checklist")[0])}),a("#upload-file-list").length>0&&a("#upload-pickfiles").length>0&&a("#upload-file-list").sortable({tolerance:"touch",cursor:"move"}).disableSelection(),a("#user-security").length>0&&a("body").on("keyup","input[name=pass1], input[name=pass2]",function(){g(a("#pass1"),a("#pass2"),a("#pass-strength-result"),a(""),["black","listed","word"])})})}(jQuery);